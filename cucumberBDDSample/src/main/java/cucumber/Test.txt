[
  {
    "$group": {
      "_id": "$company_id",
      "uniqueStatusCodes": { "$addToSet": "$status_code" },
      "users": { "$push": "$user_id" }
    }
  },
  {
    "$match": {
      "uniqueStatusCodes.1": { "$exists": true }
    }
  },
  {
    "$project": {
      "company_id": "$_id",
      "users": 1,
      "uniqueStatusCodes": 1,
      "_id": 0
    }
  }
]
